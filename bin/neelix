#!/usr/bin/ruby

# Different behavior based on whether we are installed, or running from rake
config = {}
if ENV.member?('NEELIX_UNINSTALLED')
  puts "Uninstalled..."
  prefix = File.dirname(__FILE__) + '/../'
  config['datadir'] = prefix + '/data'
  $:.push(prefix + '/lib')
else
  require 'rbconfig'
  config['datadir'] = Config::CONFIG['datadir']
end

require 'neelix'
require 'neelix/view/qt'

# Establish database connection 
# (TODO: if file doesn't exist create it using data/neelix/create.sql)
ar = { :adapter => 'sqlite3', :dbfile => ENV['HOME']+'/.neelix/db' }
ar[:dbfile] = ARGV[0] unless ARGV.empty?
ActiveRecord::Base.establish_connection(ar)

if $0 == __FILE__
  a = Qt::Application.new(ARGV)
  w = Neelix.new
  a.mainWidget = w
  w.show
  a.exec
end
